<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ƒêI·ªÇM B√ÄI ‚Äî Neo Score Tracker</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --yellow: #ffe17c;
    --charcoal: #171e19;
    --sage: #b7c6c2;
    --white: #ffffff;
    --black: #000000;
    --dark2: #272727;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--charcoal);
    font-family: 'Space Grotesk', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* DOT PATTERN */
  .dot-bg {
    background-color: var(--yellow);
    background-image: radial-gradient(circle, #00000018 1px, transparent 1px);
    background-size: 32px 32px;
  }

  /* NAV */
  nav {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 72px;
    background: var(--yellow);
    border-bottom: 2px solid var(--black);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 2rem;
    z-index: 100;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.25rem;
    font-weight: 800;
    letter-spacing: -0.05em;
    color: var(--black);
  }

  .logo-icon {
    width: 36px; height: 36px;
    background: var(--black);
    display: flex; align-items: center; justify-content: center;
    border: 2px solid var(--black);
  }

  .logo-icon span { color: var(--yellow); font-size: 1.1rem; }

  .nav-btn {
    background: var(--black);
    color: var(--white);
    border: 2px solid var(--black);
    padding: 0.5rem 1.25rem;
    font-family: inherit;
    font-weight: 700;
    font-size: 0.9rem;
    cursor: pointer;
    border-radius: 8px;
    box-shadow: 4px 4px 0 var(--black);
    transition: all 0.15s ease;
  }

  .nav-btn:hover { transform: translate(2px,2px); box-shadow: 2px 2px 0 var(--black); }

  /* MAIN */
  main {
    padding-top: 72px;
    min-height: 100vh;
  }

  /* HERO / SETUP SECTION */
  #setup-section {
    min-height: calc(100vh - 72px);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 3rem 1rem;
  }

  .hero-title {
    font-size: clamp(3rem, 8vw, 6rem);
    font-weight: 800;
    letter-spacing: -0.05em;
    color: var(--black);
    text-align: center;
    line-height: 1;
    margin-bottom: 0.5rem;
  }

  .hero-title .outline {
    -webkit-text-stroke: 3px var(--black);
    color: transparent;
  }

  .hero-sub {
    text-align: center;
    font-size: 1.1rem;
    color: var(--dark2);
    font-weight: 500;
    margin-bottom: 2.5rem;
  }

  /* SETUP CARD */
  .setup-card {
    background: var(--white);
    border: 2px solid var(--black);
    border-radius: 12px;
    box-shadow: 8px 8px 0 var(--black);
    padding: 2rem;
    width: 100%;
    max-width: 560px;
  }

  .setup-card h2 {
    font-size: 1.4rem;
    font-weight: 800;
    margin-bottom: 1.25rem;
    letter-spacing: -0.03em;
  }

  .player-input-row {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
  }

  .player-input-row input {
    flex: 1;
    padding: 0.65rem 1rem;
    border: 2px solid var(--black);
    border-radius: 8px;
    font-family: inherit;
    font-size: 0.95rem;
    font-weight: 500;
    outline: none;
    transition: box-shadow 0.15s;
  }

  .player-input-row input:focus { box-shadow: 4px 4px 0 var(--black); }

  .remove-btn {
    width: 40px; height: 40px;
    background: #fee2e2;
    border: 2px solid var(--black);
    border-radius: 8px;
    font-size: 1.1rem;
    cursor: pointer;
    font-weight: 700;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.15s;
  }
  .remove-btn:hover { background: #fca5a5; transform: translate(2px,2px); }

  .add-player-btn {
    width: 100%;
    padding: 0.7rem;
    background: var(--sage);
    border: 2px solid var(--black);
    border-radius: 8px;
    font-family: inherit;
    font-weight: 700;
    font-size: 0.95rem;
    cursor: pointer;
    box-shadow: 4px 4px 0 var(--black);
    transition: all 0.15s;
    margin-bottom: 1.25rem;
  }
  .add-player-btn:hover { transform: translate(4px,4px); box-shadow: 0 0 0 var(--black); }

  .start-btn {
    width: 100%;
    padding: 1rem;
    background: var(--black);
    color: var(--white);
    border: 2px solid var(--black);
    border-radius: 10px;
    font-family: inherit;
    font-weight: 800;
    font-size: 1.1rem;
    cursor: pointer;
    box-shadow: 8px 8px 0 #333;
    transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    letter-spacing: -0.02em;
  }
  .start-btn:hover { transform: translate(4px,4px); box-shadow: 4px 4px 0 #333; }

  /* GAME SECTION */
  #game-section { display: none; padding: 2rem 1rem 3rem; }

  .game-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .game-title {
    font-size: 2rem;
    font-weight: 800;
    color: var(--yellow);
    letter-spacing: -0.04em;
  }

  .reset-game-btn {
    background: var(--yellow);
    color: var(--black);
    border: 2px solid var(--black);
    border-radius: 8px;
    padding: 0.5rem 1.2rem;
    font-family: inherit;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 4px 4px 0 var(--black);
    transition: all 0.15s;
    font-size: 0.9rem;
  }
  .reset-game-btn:hover { transform: translate(2px,2px); box-shadow: 2px 2px 0 var(--black); }

  /* SCOREBOARD */
  .scoreboard {
    background: var(--dark2);
    border: 2px solid var(--sage);
    border-radius: 12px;
    padding: 1.25rem;
    margin-bottom: 2rem;
    box-shadow: 8px 8px 0 var(--black);
  }

  .scoreboard-title {
    font-size: 0.8rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    color: var(--sage);
    text-transform: uppercase;
    margin-bottom: 1rem;
  }

  .score-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.6rem 0;
    border-bottom: 1px solid #333;
  }
  .score-row:last-child { border-bottom: none; }

  .score-rank {
    width: 28px; height: 28px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-weight: 800;
    font-size: 0.8rem;
    border: 2px solid var(--black);
    flex-shrink: 0;
  }
  .rank-1 { background: var(--yellow); color: var(--black); }
  .rank-2 { background: var(--sage); color: var(--black); }
  .rank-3 { background: #cd7f32; color: var(--white); }
  .rank-other { background: var(--dark2); color: #666; border-color: #444; }

  .score-name {
    flex: 1;
    margin-left: 0.75rem;
    font-weight: 700;
    color: var(--white);
    font-size: 1rem;
  }

  .score-total {
    font-size: 1.4rem;
    font-weight: 800;
    color: var(--yellow);
    letter-spacing: -0.03em;
  }
  .score-total.negative { color: #f87171; }
  .score-total.zero { color: var(--sage); }

  /* PLAYER CARDS GRID */
  .players-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.25rem;
  }

  .player-card {
    background: var(--white);
    border: 2px solid var(--black);
    border-radius: 12px;
    box-shadow: 6px 6px 0 var(--black);
    overflow: hidden;
    transition: transform 0.15s;
  }

  .player-card-header {
    padding: 1rem 1.25rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 2px solid var(--black);
  }

  .player-card-name {
    font-size: 1.05rem;
    font-weight: 800;
    letter-spacing: -0.03em;
    color: var(--black);
  }

  .player-card-score {
    font-size: 1.6rem;
    font-weight: 800;
    letter-spacing: -0.04em;
    color: var(--black);
  }
  .player-card-score.neg { color: #dc2626; }

  .player-card-body { padding: 1rem 1.25rem; }

  .pts-label {
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.08em;
    color: #666;
    text-transform: uppercase;
    margin-bottom: 0.5rem;
  }

  /* DROPDOWN ROW */
  .score-action-row {
    display: flex;
    gap: 0.5rem;
    align-items: stretch;
    margin-bottom: 0.6rem;
  }

  .score-select {
    flex: 1;
    padding: 0.6rem 0.75rem;
    border: 2px solid var(--black);
    border-radius: 8px;
    font-family: inherit;
    font-weight: 800;
    font-size: 1rem;
    cursor: pointer;
    outline: none;
    appearance: none;
    -webkit-appearance: none;
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-size: 12px;
    padding-right: 2rem;
    transition: box-shadow 0.15s;
  }

  .score-select.select-plus {
    background-color: var(--yellow);
    color: var(--black);
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath d='M6 1v10M1 6h10' stroke='%23000' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
    box-shadow: 4px 4px 0 var(--black);
  }
  .score-select.select-plus:focus { box-shadow: 6px 6px 0 var(--black); }

  .score-select.select-minus {
    background-color: #fee2e2;
    color: #dc2626;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath d='M1 6h10' stroke='%23dc2626' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
    box-shadow: 4px 4px 0 var(--black);
  }
  .score-select.select-minus:focus { box-shadow: 6px 6px 0 var(--black); }

  .action-btn {
    padding: 0.6rem 1rem;
    border: 2px solid var(--black);
    border-radius: 8px;
    font-family: inherit;
    font-weight: 800;
    font-size: 1rem;
    cursor: pointer;
    box-shadow: 4px 4px 0 var(--black);
    transition: all 0.15s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    white-space: nowrap;
    min-width: 64px;
  }
  .action-btn:hover { transform: translate(4px,4px); box-shadow: 0 0 0 var(--black); }
  .action-btn:active { transform: translate(4px,4px); box-shadow: 0 0 0 var(--black); }

  .action-btn.btn-plus {
    background: var(--black);
    color: var(--yellow);
  }
  .action-btn.btn-minus {
    background: var(--black);
    color: #f87171;
  }

  .history-log {
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px dashed #ccc;
    max-height: 80px;
    overflow-y: auto;
    display: flex;
    flex-wrap: wrap;
    gap: 0.3rem;
  }

  .history-chip {
    font-size: 0.75rem;
    font-weight: 700;
    padding: 2px 8px;
    border-radius: 100px;
    border: 1px solid var(--black);
  }
  .history-chip.pos { background: var(--yellow); color: var(--black); }
  .history-chip.neg { background: #fee2e2; color: #dc2626; }

  /* MARQUEE */
  .marquee-bar {
    background: var(--charcoal);
    border-top: 2px solid var(--black);
    border-bottom: 2px solid var(--black);
    overflow: hidden;
    padding: 0.6rem 0;
    white-space: nowrap;
    margin-bottom: 1.5rem;
  }
  .marquee-inner {
    display: inline-block;
    animation: marquee 20s linear infinite;
    font-size: 0.85rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    color: var(--sage);
    opacity: 0.6;
  }
  @keyframes marquee { from { transform: translateX(0); } to { transform: translateX(-50%); } }

  /* FLASH ANIMATION */
  @keyframes flash-pos {
    0% { background: #ffe17c; }
    100% { background: var(--white); }
  }
  @keyframes flash-neg {
    0% { background: #fee2e2; }
    100% { background: var(--white); }
  }
  .flash-pos { animation: flash-pos 0.4s ease; }
  .flash-neg { animation: flash-neg 0.4s ease; }

  /* HIDDEN */
  .hidden { display: none !important; }

  /* SCROLLBAR */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: #222; }
  ::-webkit-scrollbar-thumb { background: var(--sage); border-radius: 3px; }

  @media (max-width: 600px) {
    .players-grid { grid-template-columns: 1fr; }
    .hero-title { font-size: 3.5rem; }
  }
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="logo">
    <div class="logo-icon"><span>‚ô†</span></div>
    ƒêI·ªÇM B√ÄI
  </div>
  <button class="nav-btn" onclick="resetAll()">‚Ü© Ch∆°i l·∫°i</button>
</nav>

<main>
  <!-- SETUP -->
  <div id="setup-section" class="dot-bg">
    <div style="margin-bottom:1.5rem; text-align:center;">
      <span style="background:var(--white);border:2px solid var(--black);padding:0.3rem 1rem;border-radius:100px;font-weight:700;font-size:0.85rem;">‚ô† ‚ô• B√ÄI T√çNH ƒêI·ªÇM ‚ô¶ ‚ô£</span>
    </div>
    <h1 class="hero-title">T√çNH<br><span class="outline">ƒêI·ªÇM</span><br>B√ÄI</h1>
    <p class="hero-sub">Nh·∫≠p t√™n ng∆∞·ªùi ch∆°i, b·∫Øt ƒë·∫ßu v√°n b√†i!</p>

    <div class="setup-card">
      <h2>üë• Ng∆∞·ªùi ch∆°i</h2>
      <div id="players-list">
        <!-- dynamic rows -->
      </div>
      <button class="add-player-btn" onclick="addPlayerInput()">+ Th√™m ng∆∞·ªùi ch∆°i</button>
      <button class="start-btn" onclick="startGame()">üÉè B·∫ÆT ƒê·∫¶U V√ÅN B√ÄI ‚Üí</button>
    </div>
  </div>

  <!-- GAME -->
  <div id="game-section">
    <div class="marquee-bar">
      <div class="marquee-inner" id="marquee-text"></div>
    </div>

    <div style="max-width:1000px;margin:0 auto;padding:0 0.5rem;">
      <div class="game-header">
        <div class="game-title">‚ô† B·∫¢NG ƒêI·ªÇM</div>
        <button class="reset-game-btn" onclick="resetScores()">üîÑ Reset ƒëi·ªÉm</button>
      </div>

      <!-- SCOREBOARD -->
      <div class="scoreboard">
        <div class="scoreboard-title">üìä X·∫øp h·∫°ng hi·ªán t·∫°i</div>
        <div id="scoreboard-rows"></div>
      </div>

      <!-- PLAYER CARDS -->
      <div class="players-grid" id="players-grid"></div>
    </div>
  </div>
</main>

<script>
  const POINT_VALUES = [1, 2, 3, 5, 10, 15, 20];
  const STORAGE_KEY = 'diem_bai_game';
  let players = [];
  let playerCount = 0;

  // ‚îÄ‚îÄ LocalStorage helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function saveGame() {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify({ players }));
    } catch(e) { console.warn('Kh√¥ng th·ªÉ l∆∞u:', e); }
  }

  function loadGame() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      return raw ? JSON.parse(raw) : null;
    } catch(e) { return null; }
  }

  function clearGame() {
    try { localStorage.removeItem(STORAGE_KEY); } catch(e) {}
  }

  // ‚îÄ‚îÄ Boot: kh√¥i ph·ª•c v√°n c≈© n·∫øu c√≥ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  window.addEventListener('DOMContentLoaded', () => {
    const saved = loadGame();
    if (saved && saved.players && saved.players.length >= 2) {
      // Hi·ªán banner th√¥ng b√°o c√≥ v√°n c≈©
      showResumeBanner(saved.players);
    } else {
      addPlayerInput();
      addPlayerInput();
    }
  });

  function showResumeBanner(savedPlayers) {
    const names = savedPlayers.map(p => p.name).join(', ');
    const banner = document.createElement('div');
    banner.id = 'resume-banner';
    banner.style.cssText = `
      position:fixed; top:72px; left:0; right:0; z-index:200;
      background:#171e19; border-bottom:2px solid #ffe17c;
      padding:1rem 1.5rem; display:flex; align-items:center;
      justify-content:space-between; gap:1rem; flex-wrap:wrap;
    `;
    banner.innerHTML = `
      <div style="color:#ffe17c; font-weight:700; font-size:0.95rem;">
        üíæ T√¨m th·∫•y v√°n c≈©: <span style="color:#b7c6c2">${names}</span>
      </div>
      <div style="display:flex; gap:0.5rem;">
        <button onclick="resumeGame()" style="background:#ffe17c;color:#000;border:2px solid #000;border-radius:8px;padding:0.4rem 1rem;font-family:inherit;font-weight:800;cursor:pointer;box-shadow:3px 3px 0 #000;font-size:0.85rem;">‚Ü© Ti·∫øp t·ª•c</button>
        <button onclick="dismissResume()" style="background:#272727;color:#b7c6c2;border:2px solid #444;border-radius:8px;padding:0.4rem 1rem;font-family:inherit;font-weight:700;cursor:pointer;font-size:0.85rem;">‚úï V√°n m·ªõi</button>
      </div>
    `;
    document.body.appendChild(banner);
    addPlayerInput();
    addPlayerInput();
  }

  function resumeGame() {
    const saved = loadGame();
    if (!saved) return;
    players = saved.players;
    document.getElementById('resume-banner')?.remove();
    showGameSection();
  }

  function dismissResume() {
    clearGame();
    document.getElementById('resume-banner')?.remove();
  }

  // ‚îÄ‚îÄ Setup ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function addPlayerInput(name = '') {
    playerCount++;
    const id = `pi-${playerCount}`;
    const div = document.createElement('div');
    div.className = 'player-input-row';
    div.id = id;
    div.innerHTML = `
      <input type="text" placeholder="T√™n ng∆∞·ªùi ch∆°i ${playerCount}" value="${name}" maxlength="20" />
      <button class="remove-btn" onclick="removePlayerInput('${id}')">‚úï</button>
    `;
    document.getElementById('players-list').appendChild(div);
  }

  function removePlayerInput(id) {
    const el = document.getElementById(id);
    if (el) el.remove();
  }

  function startGame() {
    const inputs = document.querySelectorAll('#players-list input');
    const names = [];
    inputs.forEach(inp => {
      const val = inp.value.trim();
      if (val) names.push(val);
    });
    if (names.length < 2) { alert('C·∫ßn √≠t nh·∫•t 2 ng∆∞·ªùi ch∆°i!'); return; }

    players = names.map(name => ({ name, score: 0, history: [] }));
    saveGame();
    document.getElementById('resume-banner')?.remove();
    showGameSection();
  }

  function showGameSection() {
    renderGame();
    document.getElementById('setup-section').style.display = 'none';
    document.getElementById('game-section').style.display = 'block';
    const mq = players.map(p => p.name).join(' ‚òÖ ') + ' ‚òÖ ';
    document.getElementById('marquee-text').textContent = (mq + mq + mq + mq);
  }

  // ‚îÄ‚îÄ Render ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function renderGame() {
    renderScoreboard();
    renderPlayerCards();
  }

  function renderScoreboard() {
    const sorted = [...players].map((p,i) => ({...p, idx: i})).sort((a,b) => b.score - a.score);
    const el = document.getElementById('scoreboard-rows');
    el.innerHTML = sorted.map((p, rank) => {
      const rankClass = rank === 0 ? 'rank-1' : rank === 1 ? 'rank-2' : rank === 2 ? 'rank-3' : 'rank-other';
      const scoreClass = p.score < 0 ? 'negative' : p.score === 0 ? 'zero' : '';
      return `
        <div class="score-row">
          <div class="score-rank ${rankClass}">${rank+1}</div>
          <div class="score-name">${p.name}</div>
          <div class="score-total ${scoreClass}">${p.score > 0 ? '+' : ''}${p.score}</div>
        </div>`;
    }).join('');
  }

  function renderPlayerCards() {
    const grid = document.getElementById('players-grid');
    grid.innerHTML = players.map((p, idx) => {
      const histHtml = p.history.slice(-12).map(h =>
        `<span class="history-chip ${h > 0 ? 'pos' : 'neg'}">${h > 0 ? '+' : ''}${h}</span>`
      ).join('');
      const options = POINT_VALUES.map(v => `<option value="${v}">${v} ƒëi·ªÉm</option>`).join('');
      const scoreClass = p.score < 0 ? 'neg' : '';
      return `
        <div class="player-card" id="card-${idx}">
          <div class="player-card-header">
            <div class="player-card-name">‚ô¶ ${p.name}</div>
            <div class="player-card-score ${scoreClass}" id="score-display-${idx}">${p.score > 0 ? '+' : ''}${p.score}</div>
          </div>
          <div class="player-card-body">
            <div class="pts-label">‚ûï C·ªông ƒëi·ªÉm</div>
            <div class="score-action-row">
              <select class="score-select select-plus" id="sel-plus-${idx}">${options}</select>
              <button class="action-btn btn-plus" onclick="applyScore(${idx}, 'plus')">+ C·ªòNG</button>
            </div>
            <div class="pts-label">‚ûñ Tr·ª´ ƒëi·ªÉm</div>
            <div class="score-action-row">
              <select class="score-select select-minus" id="sel-minus-${idx}">${options}</select>
              <button class="action-btn btn-minus" onclick="applyScore(${idx}, 'minus')">‚àí TR·ª™</button>
            </div>
            <div class="history-log" id="history-${idx}">${histHtml}</div>
          </div>
        </div>`;
    }).join('');
  }

  // ‚îÄ‚îÄ Score actions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function applyScore(idx, type) {
    const selId = type === 'plus' ? `sel-plus-${idx}` : `sel-minus-${idx}`;
    const val = parseInt(document.getElementById(selId).value);
    addScore(idx, type === 'plus' ? val : -val);
  }

  function addScore(idx, value) {
    players[idx].score += value;
    players[idx].history.push(value);
    saveGame(); // üíæ l∆∞u ngay sau m·ªói l·∫ßn thay ƒë·ªïi
    updateCard(idx);
    renderScoreboard();
  }

  function updateCard(idx) {
    const p = players[idx];
    const card = document.getElementById(`card-${idx}`);
    const scoreEl = document.getElementById(`score-display-${idx}`);

    scoreEl.textContent = `${p.score > 0 ? '+' : ''}${p.score}`;
    scoreEl.className = `player-card-score ${p.score < 0 ? 'neg' : ''}`;

    card.classList.remove('flash-pos','flash-neg');
    void card.offsetWidth;
    card.classList.add(p.history.at(-1) > 0 ? 'flash-pos' : 'flash-neg');

    const histEl = document.getElementById(`history-${idx}`);
    histEl.innerHTML = p.history.slice(-12).map(h =>
      `<span class="history-chip ${h > 0 ? 'pos' : 'neg'}">${h > 0 ? '+' : ''}${h}</span>`
    ).join('');
    histEl.scrollLeft = histEl.scrollWidth;
  }

  // ‚îÄ‚îÄ Reset ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function resetScores() {
    if (!confirm('Reset t·∫•t c·∫£ ƒëi·ªÉm v·ªÅ 0?')) return;
    players.forEach(p => { p.score = 0; p.history = []; });
    saveGame();
    renderGame();
  }

  function resetAll() {
    if (!confirm('K·∫øt th√∫c v√°n b√†i v√† quay l·∫°i m√†n h√¨nh nh·∫≠p t√™n?')) return;
    clearGame();
    players = [];
    playerCount = 0;
    document.getElementById('players-list').innerHTML = '';
    document.getElementById('setup-section').style.display = 'flex';
    document.getElementById('game-section').style.display = 'none';
    addPlayerInput();
    addPlayerInput();
  }
</script>
</body>
</html>